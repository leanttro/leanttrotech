<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ loja.nome }} | Tecnologia & Softwares</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    
    <style>
        /* Fonte TECH: Space Grotes k em vez de Serif */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Space+Grotesk:wght@500;700&display=swap');
        
        :root { 
            --primary: {{ loja.cor_primaria or '#7c3aed' }}; 
            --secondary: #111827;
            --announcement-bg: #000000;
            --bg-body: #ffffff;
            --text-body: #1f2937;
        }
        
        body { font-family: 'Inter', sans-serif; overflow-x: hidden; background-color: var(--bg-body); color: var(--text-body); }
        .font-display { font-family: 'Space Grotesk', sans-serif; letter-spacing: -0.02em; }
        
        .text-theme { color: var(--primary); }
        .text-secondary { color: var(--secondary); }
        .bg-theme { background-color: var(--primary); }
        .border-theme { border-color: var(--primary); }
        .hover\:bg-theme:hover { background-color: var(--primary); }
        .ring-theme { --tw-ring-color: var(--primary); }
        
        @media (min-width: 768px) {
            .category-dropdown:hover .dropdown-menu { display: block; }
        }

        .slider-container { position: relative; overflow: hidden; height: 350px; }
        @media (min-width: 768px) { .slider-container { height: 500px; } }

        .slide { 
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
            opacity: 0; transition: opacity 1s ease-in-out; z-index: 0;
            display: flex; align-items: center;
        }
        .slide.active { opacity: 1; z-index: 10; }
        
        @keyframes pulse-purple {
            0% { box-shadow: 0 0 0 0 rgba(124, 58, 237, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(124, 58, 237, 0); }
            100% { box-shadow: 0 0 0 0 rgba(124, 58, 237, 0); }
        }
        .animate-urgent { animation: pulse-purple 2s infinite; }
        .modal-overlay { background-color: rgba(0,0,0,0.6); backdrop-filter: blur(4px); }
        
        .fade-text { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        .category-scroll { scrollbar-width: thin; scrollbar-color: var(--primary) #f3f4f6; }
        .category-scroll::-webkit-scrollbar { height: 6px; }
        .category-scroll::-webkit-scrollbar-track { background: #f3f4f6; border-radius: 4px; }
        .category-scroll::-webkit-scrollbar-thumb { background-color: #d1d5db; border-radius: 4px; }
        .category-scroll::-webkit-scrollbar-thumb:hover { background-color: var(--primary); }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <div style="background-color: var(--announcement-bg);" class="py-2.5 text-[10px] md:text-xs font-bold uppercase tracking-widest text-white text-center shadow-md z-50 relative">
        <div class="container mx-auto px-4">
            <span id="announcement-text" class="fade-text block">SOFTWARES & TECNOLOGIA</span>
        </div>
    </div>

    <div class="py-6 bg-white border-b border-gray-100">
        <div class="container mx-auto px-4 grid grid-cols-1 md:grid-cols-3 gap-6 items-center">
            <div class="relative w-full max-w-xs mx-auto md:mx-0 order-2 md:order-1 flex justify-center md:justify-start">
                <div class="relative w-full group">
                    <input type="text" id="search-input" onkeyup="searchProducts()" placeholder="Buscar soluções..." class="w-full bg-gray-50 border-none rounded-full py-2.5 px-6 text-sm focus:ring-2 focus:ring-theme transition-all">
                    <i data-lucide="search" class="absolute right-4 top-2.5 w-4 h-4 text-gray-400 group-hover:text-theme transition-colors"></i>
                </div>
            </div>
            
            <div class="flex justify-center order-1 md:order-2">
                <a href="/tecnologia/" class="flex items-center gap-2 justify-center">
                    {% if loja.logo %}
                        <img src="{{ directus_url }}/assets/{{ loja.logo }}" 
                             alt="{{ loja.nome }}" 
                             class="h-10 md:h-12 object-contain"
                             onerror="this.style.display='none'; this.nextElementSibling.classList.remove('hidden');">
                        <span class="hidden text-2xl font-bold font-display text-secondary tracking-tight">{{ loja.nome }}</span>
                    {% else %}
                        <span class="text-2xl font-bold font-display text-secondary tracking-tight">{{ loja.nome }}</span>
                    {% endif %}
                </a>
            </div>
            
            <div class="flex justify-center md:justify-end items-center space-x-4 order-3 md:order-3">
                <div class="relative md:hidden">
                    <button onclick="toggleMobileCat()" class="flex items-center gap-2 bg-gray-50 rounded-lg px-3 py-2 hover:bg-gray-100 transition-colors">
                        <i data-lucide="menu" class="w-5 h-5 text-gray-700"></i>
                    </button>
                    <div id="cat-menu-overlay" onclick="toggleMobileCat()" class="hidden fixed inset-0 bg-black/60 z-[60] backdrop-blur-sm"></div>
                    <div id="cat-menu-list" class="hidden fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[85vw] max-w-xs bg-white shadow-2xl border border-gray-100 z-[70] rounded-2xl overflow-hidden animate-[fadeIn_0.2s_ease-out]">
                        <div class="bg-gray-900 px-5 py-4 flex justify-between items-center text-white">
                            <span class="font-bold text-xs uppercase tracking-widest font-display">Menu</span>
                            <button onclick="toggleMobileCat()" class="text-white/70 hover:text-white"><i data-lucide="x" class="w-5 h-5"></i></button>
                        </div>
                        <ul class="py-2 text-sm text-gray-600 text-left max-h-[60vh] overflow-y-auto">
                            <li class="px-5 py-3 hover:bg-gray-50 border-b border-gray-100">
                                <a href="/tecnologia/" class="block font-bold uppercase text-xs tracking-wider text-theme">Ver Todos</a>
                            </li>
                            {% for cat in categorias|sort(attribute='nome') %}
                            <li class="px-5 py-3 hover:bg-gray-50 border-b border-gray-50 hover:text-theme transition-colors">
                                <a href="/tecnologia/?categoria={{ cat.id }}" class="block font-medium">{{ cat.nome }}</a>
                            </li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>

                <button onclick="toggleCart()" class="flex items-center group cursor-pointer justify-center hover:scale-105 transition-transform">
                    <div class="relative p-2.5 bg-gray-900 rounded-full text-white shadow-lg shadow-purple-500/20">
                        <i data-lucide="briefcase" class="w-5 h-5"></i>
                        <span id="cart-count" class="absolute -top-1 -right-1 bg-theme text-white text-[9px] font-bold rounded-full w-5 h-5 flex items-center justify-center border-2 border-white hidden">0</span>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <nav class="hidden md:block border-b border-gray-100 sticky top-0 bg-white/95 backdrop-blur z-40">
        <div class="container mx-auto px-4 flex items-center justify-center h-14">
            <div class="relative category-dropdown h-full flex items-center px-6 cursor-pointer hover:bg-gray-50 transition-colors border-x border-transparent hover:border-gray-100">
                <div class="flex items-center space-x-2 font-bold uppercase text-xs tracking-widest text-secondary">
                    <i data-lucide="grid" class="w-4 h-4 text-theme"></i>
                    <span>Soluções</span>
                </div>
                <div class="dropdown-menu hidden absolute top-full left-0 w-64 bg-white shadow-xl border border-gray-100 z-50 rounded-b-xl overflow-hidden py-2">
                    <ul class="text-sm text-gray-600">
                        <li class="px-6 py-3 hover:bg-gray-50 hover:text-theme transition-colors">
                            <a href="/tecnologia/" class="block font-bold uppercase text-xs tracking-wider">Todas as Soluções</a>
                        </li>
                        {% for cat in categorias|sort(attribute='nome') %}
                        <li class="px-6 py-2.5 hover:bg-gray-50 hover:text-theme transition-colors">
                            <a href="/tecnologia/?categoria={{ cat.id }}" class="block">{{ cat.nome }}</a>
                        </li>
                        {% endfor %}
                    </ul>
                </div>
            </div>

            <ul class="flex items-center space-x-8 ml-8 font-bold uppercase text-[11px] tracking-[0.15em] text-gray-500">
                <li><a href="/tecnologia/" class="hover:text-theme transition-colors">Softwares</a></li>
                <li><a href="#lancamentos" class="hover:text-theme transition-colors">Destaques</a></li>
                <li><a href="#cases" class="hover:text-theme transition-colors">Cases & Projetos</a></li>
            </ul>
        </div>
    </nav>

    <section class="slider-container w-full bg-gray-900">
        <div class="absolute bottom-6 left-0 w-full flex justify-center items-center gap-4 z-20 md:hidden">
            <button onclick="changeSlide(-1)" class="bg-white/10 text-white p-3 rounded-full backdrop-blur border border-white/20 active:bg-white/20"><i data-lucide="chevron-left" class="w-5 h-5"></i></button>
            <button onclick="changeSlide(1)" class="bg-white/10 text-white p-3 rounded-full backdrop-blur border border-white/20 active:bg-white/20"><i data-lucide="chevron-right" class="w-5 h-5"></i></button>
        </div>

        <button onclick="changeSlide(-1)" class="hidden md:block absolute left-8 top-1/2 -translate-y-1/2 z-20 bg-black/30 hover:bg-theme/80 text-white p-4 rounded-full backdrop-blur-sm transition-all border border-white/10 group"><i data-lucide="chevron-left" class="w-6 h-6"></i></button>
        <button onclick="changeSlide(1)" class="hidden md:block absolute right-8 top-1/2 -translate-y-1/2 z-20 bg-black/30 hover:bg-theme/80 text-white p-4 rounded-full backdrop-blur-sm transition-all border border-white/10 group"><i data-lucide="chevron-right" class="w-6 h-6"></i></button>

        <div class="slide active">
            <div class="absolute inset-0">
                {% if loja.banner1 %}
                    <img src="{{ loja.banner1 }}" class="w-full h-full object-cover opacity-60">
                {% else %}
                    <div class="w-full h-full bg-gray-900"></div>
                {% endif %}
            </div>
            <div class="absolute inset-0 bg-gradient-to-r from-black via-purple-900/40 to-transparent"></div>
            <div class="absolute inset-0 container mx-auto px-4 flex items-center justify-start">
                <div class="max-w-xl text-left text-white pl-4 md:pl-12 mt-10">
                    <span class="inline-block py-1 px-3 rounded bg-theme/20 border border-theme text-theme text-xs font-bold uppercase tracking-widest mb-4">Soluções Digitais</span>
                    <h2 class="text-4xl md:text-6xl font-display font-bold leading-none mb-6">Inovação <br><span class="text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-400">Digital</span></h2>
                    <p class="text-gray-300 text-sm md:text-lg mb-8 font-light max-w-md">Transforme seu negócio com nossa suíte de automação e softwares prontos.</p>
                    <a href="{{ loja.link1 or '#products-grid' }}" class="bg-theme hover:bg-purple-500 text-white font-bold py-3 px-8 rounded-lg shadow-lg shadow-purple-900/50 transition-all inline-flex items-center gap-2">Ver Soluções <i data-lucide="cpu" class="w-4 h-4"></i></a>
                </div>
            </div>
        </div>

        <div class="slide">
            <div class="absolute inset-0">
                {% if loja.banner2 %}
                    <img src="{{ loja.banner2 }}" class="w-full h-full object-cover opacity-60">
                {% else %}
                    <div class="w-full h-full bg-gray-800"></div>
                {% endif %}
            </div>
            <div class="absolute inset-0 bg-gradient-to-l from-black via-blue-900/30 to-transparent"></div>
            <div class="absolute inset-0 container mx-auto px-4 flex items-center justify-end">
                <div class="max-w-xl text-right text-white pr-4 md:pr-12 mt-10">
                     <span class="inline-block py-1 px-3 rounded bg-blue-500/20 border border-blue-500 text-blue-400 text-xs font-bold uppercase tracking-widest mb-4">Alta Performance</span>
                    <h2 class="text-4xl md:text-6xl font-display font-bold leading-none mb-6">Sistemas <br><span class="text-transparent bg-clip-text bg-gradient-to-l from-blue-400 to-cyan-400">Escaláveis</span></h2>
                    <p class="text-gray-300 text-sm md:text-lg mb-8 font-light max-w-md ml-auto">Tecnologia de ponta para quem não aceita limites.</p>
                    <a href="{{ loja.link2 or '#products-grid' }}" class="bg-white text-gray-900 hover:bg-gray-100 font-bold py-3 px-8 rounded-lg shadow-lg transition-all inline-flex items-center gap-2">Saiba Mais <i data-lucide="arrow-right" class="w-4 h-4"></i></a>
                </div>
            </div>
        </div>
    </section>

    <section class="py-16 text-center" id="lancamentos">
        <div class="container mx-auto px-4">
            <h2 class="text-3xl md:text-4xl font-display font-bold text-secondary mb-2">Destaques da <span class="text-theme">Semana</span></h2>
            <p class="text-gray-500 max-w-xl mx-auto">As melhores soluções de software selecionadas para você.</p>
        </div>
    </section>

    <section class="pb-16 container mx-auto px-4">
        {% if produtos|length == 0 %}
        <div class="text-center py-20 bg-gray-50 rounded-2xl border border-dashed border-gray-200">
            <i data-lucide="server-off" class="w-16 h-16 mx-auto mb-4 text-gray-300"></i>
            <p class="text-gray-500">Nenhuma solução encontrada no momento.</p>
        </div>
        {% endif %}

        <div id="products-grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
            {% for p in produtos[:12] %}
            <div class="bg-white rounded-xl border border-gray-100 shadow-sm hover:shadow-xl hover:border-purple-100 transition-all duration-300 group overflow-hidden flex flex-col relative" id="card-{{ p.id }}">
                <div class="absolute top-3 left-3 z-10 flex flex-col gap-1 items-start">
                    {% if p.origem == 'Estoque' %}
                    <span class="bg-green-100 text-green-700 text-[9px] font-bold px-2 py-1 rounded border border-green-200 flex items-center gap-1"><i data-lucide="zap" class="w-3 h-3"></i> ATIVO</span>
                    {% endif %}
                </div>
                {% if p.urgencia == 'Alta' %}
                <div class="absolute top-3 right-3 z-10"><span class="bg-red-500 text-white text-[9px] font-bold px-2 py-1 rounded shadow-sm animate-pulse">HOT</span></div>
                {% endif %}
                <a href="/tecnologia/produto/{{ p.slug }}" class="aspect-[4/5] bg-gray-50 relative overflow-hidden block p-4">
                    <img id="img-{{ p.id }}" src="{{ p.imagem }}" alt="{{ p.nome }}" class="w-full h-full object-contain group-hover:scale-105 transition-transform duration-500 mix-blend-multiply">
                </a>
                <div class="p-5 flex flex-col flex-grow text-center">
                    <a href="/tecnologia/produto/{{ p.slug }}" class="font-bold font-display text-secondary text-sm md:text-base leading-tight mb-2 line-clamp-2 min-h-[2.5em] hover:text-theme transition-colors">{{ p.nome }}</a>
                    <div class="min-h-[30px] mb-3 flex justify-center">
                        {% if p.variantes and p.variantes|length > 0 %}
                        <div class="flex gap-2 overflow-x-auto pb-1 max-w-full justify-center">
                            <button onclick="resetImage({{ p.id }}, '{{ p.imagem }}')" class="w-5 h-5 rounded-full border border-gray-300 bg-white hover:border-theme transition-colors" title="Padrão"></button>
                            {% for v in p.variantes %}
                            <button onclick="selectVariant({{ p.id }}, '{{ v.nome }}', '{{ v.foto }}')" class="w-5 h-5 rounded-full border border-gray-200 bg-cover bg-center hover:ring-1 ring-theme transition-all" style="background-image: url('{{ v.foto }}');" title="{{ v.nome }}"></button>
                            {% endfor %}
                        </div>
                        {% endif %}
                    </div>
                    <div class="mt-auto">
                        {% if p.preco %}
                        <div class="mb-4"><span class="text-lg font-bold text-secondary">R$ {{ "%.2f"|format(p.preco)|replace('.', ',') }}</span></div>
                        {% else %}
                        <div class="mb-4"><span class="text-xs font-bold bg-gray-100 text-gray-500 px-2 py-1 rounded">Consulte</span></div>
                        {% endif %}
                        <button onclick='addToCartWithColor({{ p | tojson }})' class="w-full bg-secondary hover:bg-theme text-white font-bold py-3 px-4 rounded-lg text-xs uppercase tracking-widest transition-colors flex items-center justify-center gap-2 group-hover:shadow-lg">
                            <i data-lucide="plus-circle" class="w-4 h-4"></i> <span id="btn-text-{{ p.id }}">Tenho Interesse</span>
                        </button>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </section>

    <section class="py-16 bg-gray-50 border-t border-gray-200">
        <div class="container mx-auto px-4">
            <h2 class="text-2xl md:text-3xl font-display font-bold text-secondary mb-8 text-left">Soluções <span class="text-theme">Completas</span></h2>
            <div class="flex gap-3 overflow-x-auto pb-4 mb-6 category-scroll">
                <button onclick="filterCarousel('all')" class="filter-btn active whitespace-nowrap bg-secondary text-white px-6 py-2 rounded-full text-xs font-bold uppercase tracking-wider transition-colors flex-shrink-0" id="filter-btn-all">Todos</button>
                {% for cat in categorias %}
                <button onclick="filterCarousel('{{ cat.id }}')" class="filter-btn whitespace-nowrap bg-white border border-gray-200 text-gray-600 px-6 py-2 rounded-full text-xs font-bold uppercase tracking-wider hover:border-theme hover:text-theme transition-colors flex-shrink-0" id="filter-btn-{{ cat.id }}">{{ cat.nome }}</button>
                {% endfor %}
            </div>
            <div class="relative group">
                <button onclick="scrollProductCarousel(-1)" class="hidden md:block absolute left-0 top-1/2 -translate-y-1/2 -translate-x-1/2 z-10 bg-white p-3 rounded-full shadow-lg border border-gray-100 hover:scale-110 transition-transform"><i data-lucide="chevron-left" class="w-6 h-6 text-gray-700"></i></button>
                <div id="all-products-list" class="flex gap-6 overflow-x-auto scrollbar-hide scroll-smooth pb-8 px-1">
                    {% for p in produtos %}
                    <div class="min-w-[180px] md:min-w-[240px] max-w-[180px] md:max-w-[240px] bg-white rounded-xl border border-gray-100 shadow-sm flex-shrink-0 flex flex-col product-carousel-item" data-category="{{ p.categoria_id }}">
                        <a href="/tecnologia/produto/{{ p.slug }}" class="aspect-square bg-white p-4 block overflow-hidden relative rounded-t-xl">
                            <img src="{{ p.imagem }}" class="w-full h-full object-contain">
                        </a>
                        <div class="p-4 flex flex-col flex-grow bg-white rounded-b-xl">
                            <a href="/tecnologia/produto/{{ p.slug }}" class="font-bold text-xs md:text-sm text-secondary line-clamp-2 mb-2 h-10 hover:text-theme transition-colors">{{ p.nome }}</a>
                            <div class="mt-auto">
                                {% if p.preco %}
                                <span class="text-sm font-bold text-theme">R$ {{ "%.2f"|format(p.preco)|replace('.', ',') }}</span>
                                {% else %}
                                <span class="text-xs text-gray-400">Consulte</span>
                                {% endif %}
                                <button onclick='addToCartWithColor({{ p | tojson }})' class="w-full mt-3 bg-gray-100 hover:bg-secondary hover:text-white text-secondary text-[10px] font-bold py-2 rounded-lg uppercase tracking-widest transition-colors">Tenho Interesse</button>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                <button onclick="scrollProductCarousel(1)" class="hidden md:block absolute right-0 top-1/2 -translate-y-1/2 translate-x-1/2 z-10 bg-white p-3 rounded-full shadow-lg border border-gray-100 hover:scale-110 transition-transform"><i data-lucide="chevron-right" class="w-6 h-6 text-gray-700"></i></button>
            </div>
        </div>
    </section>

    {% if posts|length > 0 %}
    <section class="py-16 bg-white border-t border-gray-100" id="cases">
        <div class="container mx-auto px-4">
            <div class="flex justify-between items-end mb-10">
                <div>
                    <h2 class="text-3xl font-bold font-display text-secondary">Cases & <span class="text-theme">Projetos</span></h2>
                    <p class="text-gray-500 text-sm mt-1">Veja nossas implementações recentes.</p>
                </div>
            </div>
            
            <div class="relative group">
                <button onclick="scrollCases(-1)" class="hidden md:block absolute -left-4 top-1/2 -translate-y-1/2 z-10 bg-white p-3 rounded-full shadow-lg border border-gray-100 hover:scale-110 transition-transform"><i data-lucide="chevron-left" class="w-6 h-6 text-gray-700"></i></button>
                
                <div id="cases-list" class="flex gap-8 overflow-x-auto scrollbar-hide scroll-smooth pb-4 px-1">
                    {% for post in posts %}
                    <a href="/tecnologia/case/{{ post.slug }}" class="min-w-[300px] md:min-w-[350px] group cursor-pointer block bg-white rounded-2xl border border-gray-100 hover:border-purple-200 transition-all overflow-hidden shadow-sm hover:shadow-lg">
                        <div class="relative overflow-hidden aspect-video bg-gray-100">
                            <img src="{{ post.capa }}" class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105">
                            <div class="absolute top-4 left-4 bg-secondary/90 backdrop-blur px-3 py-1 text-[10px] font-bold uppercase text-white tracking-widest rounded shadow-lg">{{ post.data }}</div>
                        </div>
                        <div class="p-6">
                            <h3 class="font-bold text-lg text-secondary mb-3 group-hover:text-theme transition-colors line-clamp-1">{{ post.titulo }}</h3>
                            <p class="text-sm text-gray-500 line-clamp-2 leading-relaxed">{{ post.resumo }}</p>
                            <span class="inline-flex items-center gap-1 text-xs font-bold uppercase tracking-widest text-theme mt-4 group-hover:underline decoration-2 underline-offset-4">Ver Detalhes <i data-lucide="arrow-right" class="w-3 h-3"></i></span>
                        </div>
                    </a>
                    {% endfor %}
                </div>

                <button onclick="scrollCases(1)" class="hidden md:block absolute -right-4 top-1/2 -translate-y-1/2 z-10 bg-white p-3 rounded-full shadow-lg border border-gray-100 hover:scale-110 transition-transform"><i data-lucide="chevron-right" class="w-6 h-6 text-gray-700"></i></button>
            </div>
        </div>
    </section>
    {% endif %}

    <footer class="bg-secondary text-white pt-16 pb-8 mt-auto border-t border-gray-800">
        <div class="container mx-auto px-4">
            <div class="flex flex-col md:flex-row justify-between items-center mb-12">
                <div class="mb-8 md:mb-0 text-center md:text-left">
                    <span class="text-2xl font-bold font-display tracking-tight">{{ loja.nome }}</span>
                    <p class="text-gray-400 text-sm mt-2 max-w-xs">Soluções digitais de alta performance para o seu negócio.</p>
                </div>
                <div class="flex gap-6">
                    <a href="#" class="w-10 h-10 rounded-full bg-white/5 flex items-center justify-center hover:bg-theme transition-colors"><i data-lucide="instagram" class="w-5 h-5"></i></a>
                    <a href="#" class="w-10 h-10 rounded-full bg-white/5 flex items-center justify-center hover:bg-theme transition-colors"><i data-lucide="linkedin" class="w-5 h-5"></i></a>
                    <a href="https://wa.me/{{ loja.whatsapp }}" target="_blank" class="w-10 h-10 rounded-full bg-white/5 flex items-center justify-center hover:bg-theme transition-colors"><i data-lucide="message-circle" class="w-5 h-5"></i></a>
                </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 border-t border-gray-800 pt-8 mb-8 text-sm text-gray-400">
                 <div class="flex items-center justify-center md:justify-start gap-3"><i data-lucide="check-circle" class="w-5 h-5 text-theme"></i><span>Garantia e Suporte Especializado</span></div>
                 <div class="flex items-center justify-center md:justify-start gap-3"><i data-lucide="zap" class="w-5 h-5 text-theme"></i><span>Entrega Digital Imediata ou Agendada</span></div>
            </div>
            <p class="text-center text-xs text-gray-600 uppercase tracking-widest">© 2026 {{ loja.nome }}. Powered by Leanttro.</p>
        </div>
    </footer>

    <a href="https://wa.me/{{ loja.whatsapp }}" target="_blank" class="fixed bottom-6 right-6 z-40 bg-green-500 hover:bg-green-600 text-white p-4 rounded-full shadow-2xl transition-all hover:scale-110 flex items-center justify-center shadow-green-900/50"><i data-lucide="message-circle" class="w-6 h-6"></i></a>

    <div id="cart-modal" class="fixed inset-0 z-[60] hidden">
        <div class="absolute inset-0 modal-overlay transition-opacity duration-300" onclick="toggleCart()"></div>
        <div class="absolute right-0 top-0 h-full w-full md:w-[450px] bg-white shadow-2xl flex flex-col transform transition-transform duration-300 translate-x-full" id="cart-panel">
            <div class="p-5 border-b flex justify-between items-center bg-gray-50">
                <h2 class="font-bold text-lg flex items-center gap-2 text-secondary font-display"><i data-lucide="briefcase" class="w-5 h-5 text-theme"></i> Lista de Interesse</h2>
                <button onclick="toggleCart()" class="text-gray-400 hover:text-red-500 transition-colors"><i data-lucide="x" class="w-6 h-6"></i></button>
            </div>
            
            <div class="flex-1 overflow-y-auto p-6 space-y-6" id="cart-items"></div>
            
            <div class="p-6 border-t bg-gray-50 space-y-4">
                <div class="flex justify-between items-center text-xl font-bold pt-2 border-t border-gray-200 font-display">
                    <span class="text-gray-600">Total Estimado:</span><span id="cart-total" class="text-theme">R$ 0,00</span>
                </div>
                <button onclick="finalizarNoZap()" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-4 rounded-xl flex items-center justify-center gap-2 shadow-lg shadow-green-200 hover:shadow-green-300 transition-all active:scale-95"><i data-lucide="message-circle" class="w-5 h-5"></i> FALAR COM CONSULTOR</button>
                <p class="text-[10px] text-center text-gray-400">Produtos digitais e serviços sujeitos a análise de escopo.</p>
            </div>
        </div>
    </div>

    <script>
        lucide.createIcons();
        let currentSlide = 0;
        const slides = document.querySelectorAll('.slide');
        const lojaPhone = "{{ loja.whatsapp }}";

        const announcements = ["SUPORTE ESPECIALIZADO", "PAGAMENTO FACILITADO", "SOLUÇÕES SOB MEDIDA"];
        let annIndex = 0;
        const annElement = document.getElementById('announcement-text');
        setInterval(() => {
            if(!annElement) return;
            annIndex = (annIndex + 1) % announcements.length;
            annElement.style.opacity = 0;
            setTimeout(() => { annElement.innerText = announcements[annIndex]; annElement.style.opacity = 1; }, 300);
        }, 3500);

        function changeSlide(direction) {
            if (slides.length === 0) return;
            slides[currentSlide].classList.remove('active');
            currentSlide = (currentSlide + direction + slides.length) % slides.length;
            slides[currentSlide].classList.add('active');
        }
        if(slides.length > 1) setInterval(() => changeSlide(1), 5000);

        let cart = [];
        let userSelections = {};

        try { cart = JSON.parse(localStorage.getItem('cart_v2') || '[]'); } catch(e) { cart = []; }

        function saveCart() { localStorage.setItem('cart_v2', JSON.stringify(cart)); updateCartUI(); }

        function toggleMobileCat() {
            document.getElementById('cat-menu-list').classList.toggle('hidden');
            document.getElementById('cat-menu-overlay').classList.toggle('hidden');
        }

        function toggleCart() {
            const modal = document.getElementById('cart-modal');
            const panel = document.getElementById('cart-panel');
            if (modal.classList.contains('hidden')) {
                modal.classList.remove('hidden');
                setTimeout(() => panel.classList.remove('translate-x-full'), 10);
            } else {
                panel.classList.add('translate-x-full');
                setTimeout(() => modal.classList.add('hidden'), 300);
            }
        }

        function changeQty(idx, delta) {
            if (cart[idx]) {
                cart[idx].qtd += delta;
                if (cart[idx].qtd <= 0) cart.splice(idx, 1);
                saveCart();
            }
        }

        function updateCartUI() {
            const container = document.getElementById('cart-items');
            const totalEl = document.getElementById('cart-total');
            const countEl = document.getElementById('cart-count');
            const totalQtd = cart.reduce((acc, i) => acc + i.qtd, 0);
            if(countEl) { countEl.innerText = totalQtd; countEl.classList.toggle('hidden', totalQtd === 0); }
            container.innerHTML = '';
            let total = 0;
            if (cart.length === 0) container.innerHTML = `<div class="text-center py-12 opacity-40"><i data-lucide="briefcase" class="w-12 h-12 mx-auto mb-2"></i><p class="text-sm">Lista de interesse vazia.</p></div>`;
            cart.forEach((item, i) => {
                total += (item.preco || 0) * item.qtd;
                container.innerHTML += `<div class="flex gap-4 border-b border-gray-100 pb-4 last:border-0 animate-[fadeIn_0.2s_ease-out]"><img src="${item.imagem}" class="w-16 h-16 object-contain rounded-md bg-white border border-gray-100 p-1"><div class="flex-1 min-w-0"><h4 class="font-bold text-xs text-secondary line-clamp-2 mb-1">${item.nome_exibicao}</h4><div class="flex justify-between items-center mt-2"><span class="text-theme font-bold text-sm">R$ ${(item.preco * item.qtd).toFixed(2).replace('.',',')}</span><div class="flex items-center gap-2 bg-gray-50 rounded px-2 py-1 border border-gray-200"><button onclick="changeQty(${i}, -1)" class="w-5 h-5 flex items-center justify-center font-bold text-gray-500">-</button><span class="text-xs font-bold w-4 text-center">${item.qtd}</span><button onclick="changeQty(${i}, 1)" class="w-5 h-5 flex items-center justify-center font-bold text-gray-500">+</button></div></div></div><button onclick="removeFromCart(${i})" class="text-gray-300 hover:text-red-500 self-start"><i data-lucide="trash-2" class="w-4 h-4"></i></button></div>`;
            });
            totalEl.innerText = "R$ " + total.toFixed(2).replace('.', ',');
            lucide.createIcons();
        }

        function removeFromCart(idx) { cart.splice(idx, 1); saveCart(); }
        function selectVariant(pid, name, photo) { const img = document.getElementById(`img-${pid}`); if(img) img.src = photo; userSelections[pid] = { nome: name, foto: photo }; }
        function resetImage(pid, original) { const img = document.getElementById(`img-${pid}`); if(img) img.src = original; delete userSelections[pid]; }
        function addToCartWithColor(product) {
            let final = { ...product };
            const sel = userSelections[product.id];
            if (sel) { final.nome_exibicao = `${product.nome} (${sel.nome})`; final.imagem = sel.foto; final.cart_id = `${product.id}-${sel.nome}`; }
            else { final.nome_exibicao = product.nome; final.cart_id = `${product.id}-padrao`; }
            const idx = cart.findIndex(i => i.cart_id === final.cart_id);
            if (idx > -1) cart[idx].qtd++; else { final.qtd = 1; cart.push(final); }
            saveCart(); toggleCart();
        }

        function finalizarNoZap() {
            if (cart.length === 0) return alert("Selecione alguma solução primeiro!");
            let msg = `Olá! Tenho interesse nas seguintes soluções digitais:\n\n`;
            let total = 0;
            cart.forEach(i => { msg += `— ${i.qtd}x ${i.nome_exibicao}\n`; if(i.preco) { msg += `   R$ ${(i.preco * i.qtd).toFixed(2)}\n`; total += i.preco * i.qtd; } });
            msg += `--------------------------------\n`;
            msg += `*Investimento Estimado:* R$ ${total.toFixed(2).replace('.', ',')}\n`;
            msg += `\nGostaria de agendar uma reunião ou tirar dúvidas.`;
            window.open(`https://wa.me/${lojaPhone}?text=${encodeURIComponent(msg)}`, '_blank');
        }

        function searchProducts() {
            const input = document.getElementById('search-input');
            const filter = input.value.toLowerCase();
            const grids = [document.getElementById('products-grid'), document.getElementById('all-products-list')];
            grids.forEach(grid => {
                if(!grid) return;
                Array.from(grid.children).forEach(card => {
                    const text = card.textContent || card.innerText;
                    card.style.display = text.toLowerCase().indexOf(filter) > -1 ? '' : 'none';
                });
            });
        }

        function filterCarousel(catId) {
            const items = document.querySelectorAll('.product-carousel-item');
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('bg-secondary', 'text-white');
                btn.classList.add('bg-white', 'text-gray-600');
                if(btn.id === 'filter-btn-' + catId) { btn.classList.remove('bg-white', 'text-gray-600'); btn.classList.add('bg-secondary', 'text-white'); }
            });
            const target = String(catId).trim();
            items.forEach(item => { const itemCat = String(item.getAttribute('data-category') || '').trim(); item.style.display = (target === 'all' || itemCat === target) ? '' : 'none'; });
        }

        function scrollProductCarousel(direction) { document.getElementById('all-products-list').scrollBy({ left: direction * 300, behavior: 'smooth' }); }
        
        function scrollCases(direction) {
            const el = document.getElementById('cases-list');
            if(el) el.scrollBy({ left: direction * 350, behavior: 'smooth' });
        }
        
        updateCartUI();
        
        // NOVO CÓDIGO: Verifica se veio da página de produto
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get('open_cart') === 'true') {
            toggleCart(); // Abre o modal do carrinho automaticamente
            
            // Limpa a URL para não ficar abrindo se der F5
            window.history.replaceState({}, document.title, "/tecnologia/");
        }
    </script>
</body>
</html>